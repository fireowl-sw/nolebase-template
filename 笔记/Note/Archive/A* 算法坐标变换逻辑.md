# A* 算法坐标变换逻辑

## 一、整体流程

```
世界坐标(米) ──转换──→ 网格坐标(格子) ──A*搜索──→ 网格坐标 ──转换──→ 世界坐标(米)
     ↓                   ↓                   ↓                    ↓
  机器人位置        转成行列索引         返回路径            转回米发布
  目标位置
```

---

## 二、第一步：世界坐标 → 网格坐标

将物理世界的 **米** 转换为栅格地图的 **行列索引**。

### 输入
| 类型      | 变量                             |
| ------- | ------------------------------ |
| 机器人世界坐标 | `self.x`, `self.y`             |
| 目标世界坐标  | `self.goal[0]`, `self.goal[1]` |

### 转换公式
```python
column = (self.x - originX) / resolution  # x 转列索引
row    = (self.y - originY) / resolution  # y 转行索引

start = (row, column)      # A* 起点 (网格坐标)
goal  = (rowH, columnH)    # A* 终点 (网格坐标)
```

### 示意图
```
世界坐标 (米)                    网格坐标 (格子)
     (x: -8, y: 8)    ──转换──→    (row: 40, col: 40)
```

---

## 第二步：A* 在网格中搜索

| 项目 | 说明 |
|------|------|
| **输入** | 网格坐标 `start → goal` |
| **输出** | 网格坐标路径 `[(row1, col1), (row2, col2), ...]` |

---

## 三、第三步：网格坐标 → 世界坐标

将 A* 返回的 **网格索引** 转换回 **物理米** 单位，用于发布到 ROS 话题。

### 转换公式
```python
# p[0] = row, p[1] = column

x = p[1] * resolution + originX  # 列索引转回 x
y = p[0] * resolution + originY  # 行索引转回 y

paths = [(x, y), (x, y), ...]    # 发布到 ROS 话题
```

### 示意图
```
网格坐标 (格子)                  世界坐标 (米)
    [(40,40), (41,40)...]    ──转换──→    (x1, y1), (x2, y2)...
         ↑                              ↑
       原始路径数据                  发布路径用
```

---

## 四、完整数据流图

```
┌─────────────────────────────────────────────────────────────────┐
│                         完整流程                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   世界坐标 (米)                                                  │
│   (x: -8, y: 8)         网格坐标 (格子)                          │
│        │                      │                                 │
│        │   坐标转换公式        │                                 │
│        │   (x-origin)/res     │                                 │
│        │   (y-origin)/res     │                                 │
│        └──────────┬───────────┘                                 │
│                   │                                             │
│                   ▼                                             │
│            (row: 40, col: 40)                                   │
│                   │                                             │
│                   │              A* 搜索算法                     │
│                   │                                             │
│                   ▼                                             │
│            [(40,40), (41,40)...]                                │
│                   │                                             │
│                   │   坐标转换公式                               │
│                   │   row*res + originY                         │
│                   │   col*res + originX                         │
│                   └──────────┬───────────┘                                 │
│                              │                                             │
│                              ▼                                             │
│                         (x1, y1)                                          │
│                              │                                             │
│                              ▼                                             │
│                     发布到 ROS 话题                                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 五、关键点总结

| 步骤 | 方向 | 转换公式 |
|------|------|----------|
| 世界 → 网格 | `x → col` | `col = (x - originX) / resolution` |
| 世界 → 网格 | `y → row` | `row = (y - originY) / resolution` |
| 网格 → 世界 | `col → x` | `x = col * resolution + originX` |
| 网格 → 世界 | `row → y` | `y = row * resolution + originY` |

---

## 六、注意事项

> 📌 **原点 (originX, originY)** 是地图左下角对应的世界坐标  
> 📌 **分辨率 (resolution)** 表示每个格子代表的物理米数  
> 📌 转换时注意 **x 对应列 (column)**，**y 对应行 (row)**
